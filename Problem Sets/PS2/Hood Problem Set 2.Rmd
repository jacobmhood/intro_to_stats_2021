---
title: "Problem Set 2"
author: "Jacob Hood"
date: "3/20/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(pacman)
p_load(tidyverse, foreign, corrplot, stargazer, coefplot, effects, psych, ggcorrplot)
```

# Part 1: The Replication Project

## Question 1:

### a) RQ: To what extent has the decrease in the racial pay gap over time been influenced by the different economic sources and trajectories of men and women?

### b) The authors are focused on the intersection of race and gender in producing wage gaps, and their proposal of a new theoretical framework aims to establish reasonable expectations for wage disparities between different races/genders. Importantly, the authors try to create a framework that can account for changes in the racial pay gap over time

### c)

### d)

### e)

# Part 2: Regression

```{r}
# loading data into environment
sat_df <- read.dta("sat_math.dta") 
```

## Question 2.1: Descriptive Statistics 

### a) Create a table
```{r} 
# Grouping data by gender and producing descriptive statistics
sat_df <- sat_df %>% group_by(female)

describe(sat_df)
```

### b) Correlation Matrix
```{r}

## Set use = "complete.obs" to ignore observations with NAs
M <- cor(sat_df, use = "complete.obs")

# Save the matrix to a dataframe, then use `ggcorrplot` to visualize 

ggcorrplot(as.data.frame(M), 
           hc.order = TRUE, 
           type = "lower", 
           lab = TRUE)
```

## Question 2: Scatterplots

### a) Scatterplot of DV and IV
```{r}
sat_df %>%
  ggplot(aes(x = feduy, y = sat_math)) +
  geom_point(shape = 1, alpha = 0.7) +
  labs(title = "Relationship Between Father's Years of Education and SAT Math Score",
       x = "Father's Years of Edu",
       y = "SAT Math")
```

### b) Scatterplot of DV and IV with fitted regression line
```{r}
sat_df %>%
  ggplot(aes(x = feduy, y = sat_math)) +
  geom_point(shape = 1, alpha = 0.7) +
  geom_smooth(method = "lm", se = F) +
  labs(title = "Relationship Between Father's Years of Education and SAT Math Score",
       x = "Father's Years of Edu",
       y = "SAT Math")
```

### c) A scatter plot of the DV and IV, and each observation is color coded by gender
```{r} 
# Create new variable 'gender'
sat_df <- sat_df %>%
  mutate(gender = ifelse(female == 1, "female", "male"))

sat_df %>% as_tibble() %>% ggplot(aes(x = feduy, y = sat_math, color = gender)) +
  geom_point(shape = 1) +
  labs(title = "Relationship Between Father's Years of Education and SAT Math Score",
       x = "Father's Years of Edu",
       y = "SAT Math")
```

### d) Fit a linear regression for each gender
```{r}
sat_df %>% as_tibble() %>%
  ggplot(aes(x = feduy, y = sat_math, color = gender)) +
  geom_point(shape = 1) +
  geom_smooth(method = "lm", se = F) +
  labs(title = "Relationship Between Father's Years of Education and SAT Math Score",
       x = "Father's Years of Edu",
       y = "SAT Math")
```

## Question 3: Additional exploratory data analysis

## Question 4: Nested Models
```{r}
# Creating the five models
m1 <- lm(sat_math ~ IQ, data = sat_df)
m2 <- lm(sat_math ~IQ + female + black + other, data = sat_df)
m3 <- lm(sat_math ~IQ + female + black + other + feduy + meduy, data = sat_df)
m4 <- lm(sat_math ~IQ + female + black + other + feduy + meduy + hours, data = sat_df)
m5 <- lm(sat_math ~IQ + female + black + other + feduy + meduy + hours + IQ*female, data = sat_df)

stargazer(m1, m2, m3, m4, m5, type = "text")
```

## Question 5
