---
title: "Hood Replication Project"
author: "Jacob Hood"
date: "4/1/2021"
output: pdf_document
---

## Setting up environment 
```{r setup, include=FALSE, results = "asis"}
knitr::opts_chunk$set(echo = TRUE)
library(pacman)
p_load(tidyverse, ipumsr, kableExtra)
```

## Loading data into environment
```{r loading data}
ddi <- read_ipums_ddi("usa_00003.xml")
data <- read_ipums_micro(ddi)
crosswalk_data <- read.csv("occ_crosswalk.csv")
```

## Cleaning data
```{r selecting variables}
# Selecting variables to keep 
data_clean <- data %>%
  select(YEAR, SAMPLE, SERIAL, PERNUM, PERWT, REGION,	METRO,	NCHILD,	NCHLT5,	SEX, AGE,	MARST, RACE, HISPAN, BPL, EDUC, EDUCD, LABFORCE,	CLASSWKR, CLASSWKRD, OCC1990,	WKSWORK2,	UHRSWORK, INCWAGE)
```

```{r remove percentiles}
# Removing the top (99%) and bottom (1%) income percentiles 
data_clean <- data_clean %>% filter(INCWAGE < quantile(data_clean$INCWAGE, 0.99) & INCWAGE > quantile(data_clean$INCWAGE, 0.01))
```

```{r select correct obvs}
# Filtering out people active in labor force, black or white, ages 25-59, and not Hispanic
data_clean <- data_clean %>% 
  filter(LABFORCE == 2 & AGE <= 59 & AGE >= 25 & HISPAN == 0 & RACE < 3) %>%
  filter(EDUC != 0 & INCWAGE < 999998) # Removing missing values for education and income
```

```{r create unique id}
# Creating unique id for each observation 
data_clean <- data_clean %>% unite("ID", "SAMPLE", "SERIAL", "PERNUM", remove = T)

nrow(data_clean)
n_distinct(data_clean$ID) # Checking that each ID is unique 
head(data_clean)
```

```{r new variables}
# Finally, create new variables for log weekly hours worked, weekly wage, log weekly wage, potential work experience,
# and potential work experience squared 
data_clean <- data_clean %>% mutate("LOGWKSWRK" = log(WKSWORK2), "WKWAGE" = INCWAGE/WKSWORK2, "LOGWKWAGE" = log(INCWAGE/WKSWORK2), "PWRKEXP" = (AGE - EDUC - 6), "SQ_PWRKEXP" = PWRKEXP^2)

head(data_clean)
```

```{r new variables}
# Renaming the dummy sex and race variables to character strings, and creating a new variable for both race and gender
data_clean <- data_clean %>% mutate(GENDER = ifelse(SEX == 1, "male", "female")) %>% mutate(RACE = ifelse(RACE == 1, "white", "black" )) %>% mutate(RACEGENDER = ifelse(GENDER == "male" & RACE == "white", "white male", ifelse(GENDER == "female" & RACE== "white", "white female", ifelse(GENDER == "male" & RACE == "black", "black male", "black female")))) 
```

```{r}
# Creating variable for Foreign Born (=1)
data_clean <- data_clean %>% mutate(ForeignBorn = ifelse(BPL >= 150, 1, 0))
```

```{r}
# Creating variable for Public Sector (=1)
data_clean <- data_clean %>% mutate(PublicSector = ifelse(CLASSWKRD >= 24 & CLASSWKRD < 29, 1, 0))
```

```{r}
# Creating variable for College (=1)
data_clean <- data_clean %>% mutate(College = ifelse(EDUCD == 101, 1, 0 ))
```

```{r}
# Creating variable for Some College (=1)
data_clean <- data_clean %>% mutate(SomeCol = ifelse(EDUCD > 064 & EDUCD < 101, 1, 0))
```

```{r}
# Creating variable for High School (=1)
data_clean <- data_clean %>% mutate(HSGrad = ifelse(EDUCD >= 062 & EDUCD <= 064, 1, 0))
```

```{r}
data_clean <- data_clean %>% mutate(LessHS = ifelse(EDUCD < 062, 1, 0))
```

```{r}
# Creating variable for Married (=1)
data_clean <- data_clean %>% mutate(Married = ifelse(MARST != 1 | MARST !=2, 0, 1))
```

```{r}
# Creating variable for Presence of Child Under 5 (=1)
data_clean <- data_clean %>% mutate(Child5 = ifelse(NCHLT5 == 0, 0, 1))
```

```{r}
# Creating variable for Northeast Region (=1)
data_clean <- data_clean %>% mutate(Northeast = ifelse(REGION == 11 | REGION == 12, 1, 0))
```

```{r}
# Creating variable for Midwest Region (=1)
data_clean <- data_clean %>% mutate(Midwest = ifelse(REGION == 21 | REGION == 22, 1, 0))
```

```{r}
# Creating variable for South Region (=1)
data_clean <- data_clean %>% mutate(South = ifelse(REGION == 31 | REGION == 32 | REGION == 33, 1, 0))
```

```{r}
# Creating variable for West Region (=1)
data_clean <- data_clean %>% mutate(West = ifelse(REGION == 42 | REGION == 43, 1, 0))
```

```{r}
# Creating variable for Metro (=1)
data_clean <- data_clean %>% mutate(Metro = ifelse(METRO >= 2, 1, 0))
```

```{r}
test <- data_clean %>% filter(YEAR == 1990) %>% filter(RACEGENDER == "white male")
test %>% summarise(Weekly_wage_Adj = mean((WKWAGE/130.7)*100))
```

## Descriptive Statistics 
```{r}

```


```{r}

```

